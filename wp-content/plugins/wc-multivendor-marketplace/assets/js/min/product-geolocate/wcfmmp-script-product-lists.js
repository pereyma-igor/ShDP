jQuery(document).ready(function(o){var t=o(".wcfmmp-product-geolocate-search-form");if(o(".wcfmmp-product-geolocate-search-form").length>0&&o("#wcfmmp_radius_addr").length>0){var a=parseInt(wcfmmp_product_list_options.max_radius),e=document.getElementById("wcfmmp_radius_addr");if("google"==wcfm_maps.lib){var i=new google.maps.Geocoder,r=new google.maps.places.Autocomplete(e);r.addListener("place_changed",function(){var t=r.getPlace();o("#wcfmmp_radius_lat").val(t.geometry.location.lat()),o("#wcfmmp_radius_lng").val(t.geometry.location.lng())})}else var n=new L.Control.Search({container:"wcfm_radius_filter_container",url:"https://nominatim.openstreetmap.org/search?format=json&q={s}",jsonpParam:"json_callback",propertyName:"display_name",propertyLoc:["lat","lon"],marker:L.marker([0,0]),moveToLocation:function(t,a,e){o("#wcfmmp_radius_lat").val(t.lat),o("#wcfmmp_radius_lng").val(t.lng)},initial:!1,collapsed:!1,autoType:!1,minLength:2});if(o("#wcfmmp_radius_range").on("input",function(){o(".wcfmmp_radius_range_cur").html(this.value+wcfmmp_product_list_options.radius_unit),wcfmmp_product_list_options.is_rtl?o(".wcfmmp_radius_range_cur").css("right",this.value/a*o(".wcfm_radius_slidecontainer").outerWidth()-7.5+"px"):o(".wcfmmp_radius_range_cur").css("left",this.value/a*o(".wcfm_radius_slidecontainer").outerWidth()-7.5+"px"),$wcfmmp_radius_lat=o("#wcfmmp_radius_lat").val(),$wcfmmp_radius_lat}),wcfmmp_product_list_options.is_rtl?o(".wcfmmp_radius_range_cur").css("right",10/a*o(".wcfm_radius_slidecontainer").outerWidth()-7.5+"px"):o(".wcfmmp_radius_range_cur").css("left",10/a*o(".wcfm_radius_slidecontainer").outerWidth()-7.5+"px"),navigator.geolocation){o(".wcfmmmp_locate_icon").on("click",function(){navigator.geolocation.getCurrentPosition(function(a){console.log(a.coords.latitude,a.coords.longitude),"google"==wcfm_maps.lib?i.geocode({location:{lat:a.coords.latitude,lng:a.coords.longitude}},function(e,i){"OK"===i&&(o("#wcfmmp_radius_addr").val(e[0].formatted_address),o("#wcfmmp_radius_lat").val(a.coords.latitude),o("#wcfmmp_radius_lng").val(a.coords.longitude),t.submit())}):o.get("https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat="+a.coords.latitude+"&lon="+a.coords.longitude,function(e){o("#wcfm_radius_filter_container").find(".search-input").val(e.address.road),o("#wcfmmp_radius_lat").val(a.coords.latitude),o("#wcfmmp_radius_lng").val(a.coords.longitude),t.submit()})})}),wcfmmp_product_list_options.is_geolocate&&(o("#wcfmmp_radius_lat").val()||o(".wcfmmmp_locate_icon").click())}}if(o(".wcfmmp-product-list-map").length>0){o(".wcfmmp-product-list-map").css("height",o(".wcfmmp-product-list-map").outerWidth()/2);var c=[],s="";if(wcfmmp_product_list_options.is_poi)m=[];else var m=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];if("google"==wcfm_maps.lib){var l={zoom:$map_zoom,center:new google.maps.LatLng(wcfmmp_product_list_options.default_lat,wcfmmp_product_list_options.default_lng,13),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:m};s=new google.maps.Map(document.getElementById("wcfmmp-product-list-map"),l)}else s=L.map("wcfmmp-product-list-map",{center:[wcfmmp_product_list_options.default_lat,wcfmmp_product_list_options.default_lng],minZoom:2,zoom:13,zoomAnimation:!1}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:["a","b","c"]}).addTo(s),n&&o("#wcfmmp_radius_addr").length>0&&(s.addControl(n),o("#wcfm_radius_filter_container").find(".search-input").addClass("wcfmmp-radius-addr").attr("id","wcfmmp_radius_addr").attr("name","radius_addr").css("float","none").attr("placeholder",wcfmmp_product_list_options.search_location).val(o("#wcfmmp_radius_addr").val()),o("#wcfmmp_radius_addr").remove());!function(){if(o(".wcfmmp-product-list-map").length>0){!function(){if("google"==wcfm_maps.lib)for(var o=0;o<c.length;o++)c[o].setMap(null);c=[]}();var t={search_term:"",wcfmmp_store_category:"",wcfmmp_store_country:"",wcfmmp_store_state:"",action:"wcfmmp_stores_list_map_markers",pagination_base:1,paged:1,per_row:$per_row,per_page:$per_page,includes:$includes,excludes:$excludes,has_product:$has_product,has_orderby:$has_orderby,sidebar:$sidebar,theme:$theme,search_data:""};o.post(wcfm_params.ajax_url,t,function(t){if(t.success){var a=t.data;!function(t){if("google"==wcfm_maps.lib){var a=new google.maps.LatLngBounds,e=new google.maps.InfoWindow;if(o.each(t,function(o,t){var i=new google.maps.LatLng(t.lat,t.lang);a.extend(i);var r={url:t.icon,scaledSize:new google.maps.Size(wcfmmp_product_list_options.icon_width,wcfmmp_product_list_options.icon_height),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0)},n=new google.maps.Marker({position:i,map:s,animation:google.maps.Animation.DROP,title:t.name,icon:r,zIndex:o}),m=t.info_window_content;google.maps.event.addListener(n,"click",function(o,t){return function(){e.setContent(m),e.open(s,o)}}(n)),s.setCenter(n.getPosition()),c.push(n)}),wcfmmp_product_list_options.is_cluster){const o=wcfmmp_product_list_options.cluster_image;new MarkerClusterer(s,c,{imagePath:o})}$auto_zoom&&t.length>0&&s.fitBounds(a)}else o.each(t,function(o,a){var e=L.icon({iconUrl:a.icon,iconSize:[wcfmmp_product_list_options.icon_width,wcfmmp_product_list_options.icon_height]}),i=L.marker([a.lat,a.lang],{icon:e}).bindPopup(a.info_window_content);c.push(i);var r=L.featureGroup(c).addTo(s);$auto_zoom&&t.length>0&&setTimeout(function(){s.fitBounds(r.getBounds())},1e3)})}(o.parseJSON(a))}})}}()}});